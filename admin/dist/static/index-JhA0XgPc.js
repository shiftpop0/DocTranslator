import{r as D,f as J,_ as q}from"./index-D8_CIAd1.js";import{s as G,r as H,w as K,x as Q,v as B,E as h}from"./element-BadtrIEY.js";import{u as Y}from"./usePagination-BinwZcSU.js";import{f as W,r as k,Q as X,w as Z,i as ee,H as te,E as p,G as e,a8 as c,ae,h as d,M as t,u as i,K as s,j as P,J as E}from"./vue-CUr9ttjf.js";import"./vxe-Ca06C60r.js";function ne(f){return D({url:"translates",method:"get",params:f})}function le(f){return D({url:`/translate/${f}`,method:"delete"})}function oe(f){return D({url:"/translates/delete/batch",method:"post",data:f})}const re={class:"app-container"},ie={class:"table-wrapper"},se={class:"pager-wrapper"},ce=W({name:"Translate",__name:"index",setup(f){const S="/api",v=k(!1),{paginationData:a,handleCurrentChange:N,handleSizeChange:R}=Y(),V=n=>{B.confirm("确认删除当前文档吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{le(n.id).then(()=>{h.success("删除成功"),y()})})},_=k([]),M=n=>{_.value=n.map(m=>m.id),_.value},U=()=>{if(_.value.length===0){h.warning("请选择要删除的文档");return}B.confirm("正在批量删除选中文档，确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{oe({ids:_.value}).then(()=>{h.success("删除成功"),y()})})},L=()=>{if(_.value.length===0){h.warning("请选择要下载的文档");return}const n=_.value,m=`${S}/api/admin/translates/download/batch`,C=J();fetch(m,{method:"POST",headers:{"Content-Type":"application/json",token:C},body:JSON.stringify({ids:n})}).then(u=>{if(!u.ok)throw new Error("Network response was not ok");return u.blob()}).then(u=>{const x=`downloads_${new Date().toISOString().split("T")[0]}.zip`,l=window.URL.createObjectURL(u),o=document.createElement("a");o.href=l,o.download=x,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(l)}).catch(u=>{h.error("下载失败，请稍后重试")})},b=k([]),T=k(null),w=X({keyword:""}),y=()=>{v.value=!0,ne({page:a.currentPage,limit:a.pageSize,keyword:w.keyword||void 0}).then(({data:n})=>{a.total=n.total,b.value=n.data}).catch(()=>{b.value=[]}).finally(()=>{v.value=!1})},z=()=>{a.currentPage===1?y():a.currentPage=1},O=()=>{var n;(n=T.value)==null||n.resetFields(),z()};return Z([()=>a.currentPage,()=>a.pageSize],y,{immediate:!0}),(n,m)=>{const C=c("el-input"),u=c("el-form-item"),g=c("el-button"),x=c("el-form"),l=c("el-table-column"),o=c("el-tag"),j=c("el-link"),A=c("el-table"),I=c("el-pagination"),$=c("el-card"),F=ae("loading");return d(),ee("div",re,[te((d(),p($,{shadow:"never"},{default:e(()=>[t(x,{ref_key:"searchFormRef",ref:T,inline:!0,model:w},{default:e(()=>[t(u,{prop:"keyword",label:"",style:{width:"320px","max-width":"100%"}},{default:e(()=>[t(C,{modelValue:w.keyword,"onUpdate:modelValue":m[0]||(m[0]=r=>w.keyword=r),placeholder:"输入查询"},null,8,["modelValue"])]),_:1}),t(u,null,{default:e(()=>[t(g,{type:"primary",icon:i(G),onClick:z},{default:e(()=>[s("查询")]),_:1},8,["icon"]),t(g,{icon:i(H),onClick:O},{default:e(()=>[s("重置")]),_:1},8,["icon"]),t(g,{icon:i(K),onClick:U},{default:e(()=>[s("删除")]),_:1},8,["icon"]),t(g,{icon:i(Q),onClick:L},{default:e(()=>[s("下载")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),P("div",ie,[t(A,{data:b.value,onSelectionChange:M},{default:e(()=>[t(l,{type:"selection",width:"40",align:"left"}),t(l,{prop:"customer_no",width:"70",label:"用户ID",align:"left"}),t(l,{prop:"customer_email",label:"用户邮箱",width:"150",align:"left"}),t(l,{prop:"origin_filename",label:"文档名称",align:"left"}),t(l,{prop:"status",label:"任务状态",align:"left",width:"120"},{default:e(r=>[r.row.status=="none"?(d(),p(o,{key:0,type:"primary",effect:"plain"},{default:e(()=>[s("未完成")]),_:1})):r.row.status=="process"?(d(),p(o,{key:1,type:"warning",effect:"plain"},{default:e(()=>[s("翻译中")]),_:1})):r.row.status=="failed"?(d(),p(o,{key:2,type:"danger",effect:"plain"},{default:e(()=>[s("翻译失败")]),_:1})):(d(),p(o,{key:3,type:"success",effect:"plain"},{default:e(()=>[s("已完成")]),_:1}))]),_:1}),t(l,{prop:"start_at",label:"任务开始时间",align:"left"}),t(l,{prop:"spend_time",label:"完成用时",width:"100",align:"left"}),t(l,{prop:"deleted_flag",label:"用户是否删除",align:"left",width:"120"},{default:e(r=>[r.row.deleted_flag=="Y"?(d(),p(o,{key:0,type:"primary",effect:"plain"},{default:e(()=>[s("是")]),_:1})):r.row.deleted_flag=="N"?(d(),p(o,{key:1,type:"warning",effect:"plain"},{default:e(()=>[s("否")]),_:1})):E("",!0)]),_:1}),t(l,{fixed:"right",label:"操作",width:"100",align:"left"},{default:e(r=>[r.row.target_filepath?(d(),p(j,{key:0,style:{color:"#409eff","margin-right":"12px"},href:i(S)+"/api/admin/translate/download/"+r.row.id},{default:e(()=>[s("下载")]),_:2},1032,["href"])):E("",!0),t(g,{type:"danger",text:"",size:"small",onClick:de=>V(r.row)},{default:e(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),P("div",se,[t(I,{background:"",layout:i(a).layout,"page-sizes":i(a).pageSizes,total:i(a).total,"page-size":i(a).pageSize,currentPage:i(a).currentPage,onSizeChange:i(R),onCurrentChange:i(N)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[F,v.value]])])}}}),ge=q(ce,[["__scopeId","data-v-fb38d445"]]);export{ge as default};
