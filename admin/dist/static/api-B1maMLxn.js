import{g as ee,s as le}from"./index-CHdyCzv2.js";import{_ as te}from"./index-B9xB4neq.js";import{E as d}from"./element-C0HbadzC.js";import{r as m,d as ae,ah as b,ap as oe,m as f,p as O,P as se,M as P,O as s,U as o,F as R,a7 as z,S as I,q as n,T as q,R as ne,aE as re,aF as ue}from"./vue-DSQ7aDT9.js";import"./vxe-D9jD_6gD.js";const M=B=>(re("data-v-a2eb5c95"),B=B(),ue(),B),ie={class:"app-container"},de=M(()=>n("span",{class:"notice-tip"},"注意：会员用户使用系统默认接口",-1)),ce={class:"result-label"},pe=M(()=>n("span",null,"测试结果",-1)),me={key:0,class:"metrics-container"},fe={class:"metric-item"},_e=M(()=>n("span",{class:"metric-label"},"响应:",-1)),ve={class:"metric-value"},ge={class:"metric-item"},ke=M(()=>n("span",{class:"metric-label"},"首字:",-1)),be={class:"metric-value"},he={class:"metric-item"},ye=M(()=>n("span",{class:"metric-label"},"耗时:",-1)),Ve={class:"metric-value"},we={class:"metric-item"},Te=M(()=>n("span",{class:"metric-label"},"速度:",-1)),Me={class:"metric-value"},Se={class:"test-result-container test-result-content1"},xe={class:"dialog-footer"},$e=Object.assign({name:"接口配置"},{__name:"api",setup(B){const A=m(!1),a=m({api_url:"",api_key:"",models:"",default_model:"",default_backup:""}),h=m([]),j=m(null),G={api_url:[{required:!0,message:"请填写api接口地址",trigger:"blur"}],api_key:[{required:!0,message:"请填写API Key",trigger:"blur"}],models:[{required:!0,message:"请填写模型列表配置",trigger:"blur"}]},N=m(!1),y=m(!1),p=m(""),i=m({selectedModel:"",message:"Hello, 你好"}),_=m(null);ae(async()=>{A.value=!0,await ee().then(r=>{if(r.data){a.value=r.data;const t=r.data.models.split(",");h.value=t.filter(u=>u!="")}}),A.value=!1});function Q(){if(!a.value.models)return;const r=a.value.models.split(",");h.value=r.filter(t=>t!=""),r.indexOf(a.value.default_model)==-1&&(a.value.default_model=""),r.indexOf(a.value.default_backup)==-1&&(a.value.default_backup="")}function X(r){a.value,r.validate((t,u)=>{if(t)le({api_url:a.value.api_url,api_key:a.value.api_key,models:a.value.models,default_model:a.value.default_model,default_backup:a.value.default_backup}).then(l=>{l.code==200?d.success("保存成功"):d.error(l.message)}).catch(l=>{d.error(l)});else for(const l in u){u[l].forEach(v=>{d({message:v.message,type:"error"})});break}})}function Y(){N.value=!0,p.value="",_.value=null,h.value.length>0&&!i.value.selectedModel&&(i.value.selectedModel=h.value[0])}function Z(){if(!i.value.selectedModel){d.warning("请选择测试模型");return}if(!i.value.message.trim()){d.warning("请输入测试消息");return}y.value=!0,p.value="",_.value=null;const r=i.value.selectedModel,t=i.value.message,u={model:r,messages:[{role:"user",content:t}],stream:!0},l={start:performance.now(),response:null,firstToken:null,end:null};let v=0,T=0,V=0,S=!1,x="",$="";performance.now(),fetch(a.value.api_url+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.value.api_key}`},body:JSON.stringify(u)}).then(e=>{if(l.response=performance.now(),!e.ok)return e.text().then(g=>{y.value=!1;let k=`HTTP ${e.status}`;try{const w=JSON.parse(g);w.error&&w.error.message?k=w.error.message:k=g}catch{k=g}throw p.value=`测试失败: ${k}`,d.error(`测试失败: ${k}`),new Error(k)});const J=e.body.getReader(),C=new TextDecoder;let U="";function F(){J.read().then(({done:g,value:k})=>{var H,K;if(g){l.end=performance.now(),y.value=!1,E(),d.success("测试完成");return}U+=C.decode(k,{stream:!0});const w=U.split(`
`);U=w.pop()||"";for(const L of w)if(L.startsWith("data: ")){const W=L.slice(6);if(W==="[DONE]"){l.end=performance.now(),y.value=!1,E(),d.success("测试完成");return}try{const c=JSON.parse(W);c.usage&&(c.usage.prompt_tokens&&(v=c.usage.prompt_tokens),c.usage.completion_tokens&&(T=c.usage.completion_tokens),c.usage.reasoning_tokens&&(V=c.usage.reasoning_tokens));const D=(K=(H=c.choices)==null?void 0:H[0])==null?void 0:K.delta;D&&(l.firstToken||(l.firstToken=performance.now()),D.reasoning_content&&(S=!0,x+=D.reasoning_content,p.value=`[思考过程]
${x}`),D.content&&($+=D.content,S?p.value=`[思考过程]
${x}

[最终回答]
${$}`:p.value=$))}catch(c){console.error("解析数据错误:",c)}}F()}).catch(g=>{y.value=!1,p.value=`流读取失败: ${g.message}`,d.error(`流读取失败: ${g.message}`)})}F()}).catch(e=>{y.value=!1,p.value=`测试失败: ${e.message}`,console.error("请求错误:",e),d.error(`测试失败: ${e.message}`)});function E(){const e=l.response?Math.round(l.response-l.start):0,J=l.firstToken?Math.round(l.firstToken-l.start):0,C=l.end?Math.round(l.end-l.start):0,U=v+T+V,F=C>0?Math.round(U/C*1e3):0;_.value={responseTime:e,firstTokenTime:J,duration:C,tokensPerSecond:F}}}return(r,t)=>{const u=b("el-input"),l=b("el-form-item"),v=b("el-option"),T=b("el-select"),V=b("el-button"),S=b("el-form"),x=b("el-card"),$=b("el-dialog"),E=oe("loading");return f(),O("div",ie,[se((f(),P(x,{shadow:"never","element-loading-text":"加载中..."},{default:s(()=>[de,o(S,{class:"settingForm",ref_key:"settingForm",ref:j,model:a.value,"label-position":"top",rules:G},{default:s(()=>[o(l,{label:"Base Url",prop:"api_url",required:""},{default:s(()=>[o(u,{modelValue:a.value.api_url,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.api_url=e),placeholder:"https://api.ezworkapi.top/v1"},null,8,["modelValue"])]),_:1}),o(l,{label:"API Key",prop:"api_key",required:""},{default:s(()=>[o(u,{modelValue:a.value.api_key,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.api_key=e),placeholder:"sk-******"},null,8,["modelValue"])]),_:1}),o(l,{label:"模型列表",prop:"models",required:""},{default:s(()=>[o(u,{type:"textarea",resize:"none",rows:3,modelValue:a.value.models,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.models=e),onBlur:Q,placeholder:"请至少输入1个模型，多个模型用英文逗号,隔开"},null,8,["modelValue"])]),_:1}),o(l,{label:"默认模型"},{default:s(()=>[o(T,{modelValue:a.value.default_model,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.default_model=e),placeholder:"未选择默认模型将采用配置中的第1个",clearable:""},{default:s(()=>[(f(!0),O(R,null,z(h.value,e=>(f(),P(v,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(l,{label:"默认备用模型"},{default:s(()=>[o(T,{modelValue:a.value.default_backup,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value.default_backup=e),placeholder:"未选择默认备用模型将采用配置中的第1个",clearable:""},{default:s(()=>[(f(!0),O(R,null,z(h.value,e=>(f(),P(v,{key:e,disabled:a.value.default_model==e,label:e,value:e},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(l,{class:"setting-btns"},{default:s(()=>[o(V,{style:{width:"88px"},type:"primary",onClick:t[5]||(t[5]=e=>X(j.value))},{default:s(()=>[I("保存")]),_:1}),o(V,{type:"primary",plain:"",onClick:Y},{default:s(()=>[I("模型测试")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["element-loading-text"])),[[E,A.value]]),o($,{title:"模型测试",modelValue:N.value,"onUpdate:modelValue":t[9]||(t[9]=e=>N.value=e),width:"600px","close-on-click-modal":!1,"align-center":"",top:"1vh"},{footer:s(()=>[n("span",xe,[o(V,{onClick:t[8]||(t[8]=e=>N.value=!1)},{default:s(()=>[I("关闭")]),_:1}),o(V,{type:"primary",onClick:Z,loading:y.value},{default:s(()=>[I("测试")]),_:1},8,["loading"])])]),default:s(()=>[o(S,{model:i.value,"label-position":"top"},{default:s(()=>[o(l,{label:"选择模型"},{default:s(()=>[o(T,{modelValue:i.value.selectedModel,"onUpdate:modelValue":t[6]||(t[6]=e=>i.value.selectedModel=e),placeholder:"请选择测试模型",style:{width:"100%"}},{default:s(()=>[(f(!0),O(R,null,z(h.value,e=>(f(),P(v,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(l,{label:"测试消息"},{default:s(()=>[o(u,{modelValue:i.value.message,"onUpdate:modelValue":t[7]||(t[7]=e=>i.value.message=e),type:"textarea",rows:3,placeholder:"请输入测试消息"},null,8,["modelValue"])]),_:1}),o(l,null,{label:s(()=>[n("div",ce,[pe,_.value?(f(),O("div",me,[n("span",fe,[_e,n("span",ve,q(_.value.responseTime)+"ms",1)]),n("span",ge,[ke,n("span",be,q(_.value.firstTokenTime)+"ms",1)]),n("span",he,[ye,n("span",Ve,q(_.value.duration)+"ms",1)]),n("span",we,[Te,n("span",Me,q(_.value.tokensPerSecond)+" tokens/s",1)])])):ne("",!0)])]),default:s(()=>[n("div",Se,q(p.value),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Be=te($e,[["__scopeId","data-v-a2eb5c95"]]);export{Be as default};
