================================================================================
DocTranslator 离线部署指南 / Offline Deployment Guide
================================================================================

本指南将指导您如何将项目从联网环境迁移到不联网的 Windows 主机和服务器。

--------------------------------------------------------------------------------
第一步：在联网主机上准备 (Preparation on Networked Host)
--------------------------------------------------------------------------------
1. 确保您的项目已在本地调试完成。
2. 进入 `offline_deployment` 文件夹。
3. 运行 `export_images.ps1` 脚本。
   - 该脚本会构建最新的 backend 镜像，拉取 nginx 镜像，并将它们打包为 `images.tar`。
   - 镜像文件 `images.tar` 会生成在 `offline_deployment` 文件夹中。
4. 等待脚本完成。
5. 将整个 `DocTranslator` 文件夹打包（例如 zip 压缩）。

--------------------------------------------------------------------------------
第二步：部署到不联网 Windows 主机 (Deploy to Offline Windows Host)
--------------------------------------------------------------------------------
1. 将打包好的文件夹复制到不联网的 Windows 主机并解压。
2. 进入 `offline_deployment` 文件夹。
3. 双击运行 `install_windows.bat`。
   - 这将导入 `images.tar` 中的 Docker 镜像。
4. 双击运行 `run_windows.bat`。
   - 这将启动 Docker 服务。
5. 访问服务：
   - 前端: http://localhost:1475
   - 管理端: http://localhost:8081
   - 后端 API: http://localhost:5000

--------------------------------------------------------------------------------
第三步：部署到不联网服务器 (Deploy to Offline Server)
--------------------------------------------------------------------------------
假设您的服务器是 Linux 环境，且已安装 Docker 和 Docker Compose。

1. 将 `DocTranslator` 文件夹从 Windows 主机上传到服务器。
2. 进入 `offline_deployment` 目录：
   cd DocTranslator/offline_deployment
3. 赋予脚本执行权限：
   chmod +x install_server.sh run_server.sh
4. 运行安装脚本导入镜像：
   ./install_server.sh
5. 运行启动脚本：
   ./run_server.sh
6. 服务启动后，通过服务器 IP 访问对应端口。

--------------------------------------------------------------------------------
局域网访问配置 (LAN Access)
--------------------------------------------------------------------------------
本项目已配置为支持局域网访问。部署成功后，局域网内的其他电脑可以通过服务器的 IP 地址访问服务。

1. 【如何获取服务器 IP】
   - Linux: 运行 `ifconfig` 或 `ip addr`
   - Windows: 运行 `ipconfig`

2. 【访问地址示例】
   假设服务器 IP 为 192.168.1.100：
   - 前端访问地址: http://192.168.1.100:1475
   - 管理后台地址: http://192.168.1.100:8081

   注意：请确保服务器防火墙已放行 1475 和 8081 端口。

--------------------------------------------------------------------------------
常见问题与故障排查 (Troubleshooting)
--------------------------------------------------------------------------------
【如何检查端口是否被占用】
本项目默认使用端口：5000 (后端), 1475 (前端), 8081 (管理端)

1. Linux 服务器 (Server):
   - 查看所有端口占用: netstat -tuln
   - 查看特定端口(如5000): netstat -tuln | grep 5000
   - 或者使用 lsof: lsof -i :5000
   - 或者使用 ss: ss -tuln | grep 5000

2. Windows 主机:
   - 打开 CMD 或 PowerShell
   - 查看特定端口(如5000): netstat -ano | findstr 5000

【如果端口被占用怎么办】
1. 找到占用端口的进程并关闭它。
2. 或者修改 `offline_deployment/docker-compose.offline.yml` 文件中的端口映射。
   例如将 5000:5000 改为 5001:5000

--------------------------------------------------------------------------------
注意事项 (Notes)
--------------------------------------------------------------------------------
- 所有部署脚本和配置文件现在都位于 `offline_deployment` 文件夹中。
- `docker-compose.offline.yml` 中的路径已更新，以正确引用上级目录中的代码和配置。
- 数据存储在 `backend/db` 和 `backend/storage` 目录中（位于 `offline_deployment` 的上级目录）。
