import{_ as N,r as m,T as _,c as $,a as u,F as R,m as S,l as q,a1 as F,h as o,w as a,ag as T,L as O,z as p,o as z,C as P,t as B,B as c,i as E,ah as M,ai as A,E as n,aj as G}from"./index-Z-crM38B.js";import{f as H,b as J}from"./auth-CkFQFBOo.js";const Q={class:"auth-page"},W={class:"auth-container"},X={class:"tab-container"},Y={class:"tab-tabs"},Z=["onClick"],ee={class:"action-links"},oe={__name:"index",setup(le){const v=O(),f=m("forget"),j=[{label:"忘记密码",value:"forget"},{label:"修改密码",value:"change"}],r=_({email:"",code:"",password:"",password_confirmation:""}),i=_({oldpwd:"",newpwd:"",newpwd_confirmation:""}),D=_({email:[{required:!0,message:"请填写邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请填写邮箱验证码",trigger:"blur"}],password:[{required:!0,message:"请填写新密码",trigger:"blur"}],password_confirmation:[{required:!0,message:"请填写确认密码",trigger:"blur"}]}),I=_({oldpwd:[{required:!0,message:"请填写原密码",trigger:"blur"}],newpwd:[{required:!0,message:"请填写新密码",trigger:"blur"}],newpwd_confirmation:[{required:!0,message:"请填写确认密码",trigger:"blur"}]}),w=m("发送"),g=m(!1),b=m(),y=m(),K=async()=>{if(!g.value){if(!r.email.trim()){n.error("请填写邮箱地址");return}try{await H(r.email),n.success("验证码已发送"),g.value=!0;let d=60;w.value=`${d}s`;const e=setInterval(()=>{if(d<=0){clearInterval(e),g.value=!1,w.value="发送";return}d--,w.value=`${d}s`},1e3)}catch(d){n.error(d.message)}}},V=async d=>{d.validate((e,t)=>{if(e){if(r.password!==r.password_confirmation){n.error("两次密码输入不一致");return}J(r).then(s=>{s.code===200?(n.success("密码重置成功"),v.push({name:"login"})):n.error(s.message)}).catch(s=>{n.error(s.message)})}else n.error(t[Object.keys(t)[0]][0].message)})},h=async d=>{d.validate((e,t)=>{if(e){if(i.newpwd!==i.newpwd_confirmation){n.error("两次密码输入不一致");return}G(i).then(s=>{s.code===200?(n.success("密码修改成功"),v.push({name:"login"})):n.error(s.message)}).catch(s=>{n.error(s.message)})}else n.error(t[Object.keys(t)[0]][0].message)})},L=()=>{v.push({name:"login"})};return(d,e)=>{const t=p("el-input"),s=p("el-form-item"),k=p("el-button"),x=p("el-form"),C=p("el-icon"),U=p("el-link");return z(),$("div",Q,[u("div",W,[e[16]||(e[16]=u("div",{class:"auth-header"},[u("h1",{class:"auth-title"},"密码管理"),u("p",{class:"auth-subtitle"},"选择需要的操作")],-1)),u("div",X,[u("div",Y,[(z(),$(R,null,S(j,l=>u("div",{key:l.value,class:P(["tab-item",{active:f.value===l.value}]),onClick:se=>f.value=l.value},B(l.label),11,Z)),64))])]),q(o(x,{ref_key:"forgetForm",ref:b,model:r,"show-message":!1,rules:D,onKeyup:e[5]||(e[5]=T(l=>V(b.value),["enter"])),class:"form-content"},{default:a(()=>[o(s,{label:"",prop:"email"},{default:a(()=>[o(t,{modelValue:r.email,"onUpdate:modelValue":e[0]||(e[0]=l=>r.email=l),placeholder:"输入邮箱","prefix-icon":"el-icon-message"},null,8,["modelValue"])]),_:1}),o(s,{label:"",prop:"code"},{default:a(()=>[o(t,{modelValue:r.code,"onUpdate:modelValue":e[1]||(e[1]=l=>r.code=l),placeholder:"邮箱验证码","prefix-icon":"el-icon-key"},{suffix:a(()=>[o(k,{type:"text",class:"code-btn",onClick:K,disabled:g.value},{default:a(()=>[c(B(w.value),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"",prop:"password"},{default:a(()=>[o(t,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=l=>r.password=l),type:"password","show-password":"",placeholder:"设置新密码","prefix-icon":"el-icon-lock"},null,8,["modelValue"])]),_:1}),o(s,{label:"",prop:"password_confirmation"},{default:a(()=>[o(t,{modelValue:r.password_confirmation,"onUpdate:modelValue":e[3]||(e[3]=l=>r.password_confirmation=l),type:"password","show-password":"",placeholder:"确认新密码","prefix-icon":"el-icon-lock"},null,8,["modelValue"])]),_:1}),o(s,{label:"",class:"center"},{default:a(()=>[o(k,{type:"primary",size:"large",class:"auth-btn",onClick:e[4]||(e[4]=l=>V(b.value))},{default:a(()=>e[12]||(e[12]=[c("提交重置")])),_:1})]),_:1})]),_:1},8,["model","rules"]),[[F,f.value==="forget"]]),q(o(x,{ref_key:"changeForm",ref:y,model:i,"show-message":!1,rules:I,onKeyup:e[10]||(e[10]=T(l=>h(y.value),["enter"])),class:"form-content"},{default:a(()=>[o(s,{label:"",prop:"oldpwd"},{default:a(()=>[o(t,{modelValue:i.oldpwd,"onUpdate:modelValue":e[6]||(e[6]=l=>i.oldpwd=l),type:"password","show-password":"",placeholder:"原密码","prefix-icon":"el-icon-lock"},null,8,["modelValue"])]),_:1}),o(s,{label:"",prop:"newpwd"},{default:a(()=>[o(t,{modelValue:i.newpwd,"onUpdate:modelValue":e[7]||(e[7]=l=>i.newpwd=l),type:"password","show-password":"",placeholder:"设置新密码","prefix-icon":"el-icon-lock"},null,8,["modelValue"])]),_:1}),o(s,{label:"",prop:"newpwd_confirmation"},{default:a(()=>[o(t,{modelValue:i.newpwd_confirmation,"onUpdate:modelValue":e[8]||(e[8]=l=>i.newpwd_confirmation=l),type:"password","show-password":"",placeholder:"确认新密码","prefix-icon":"el-icon-lock"},null,8,["modelValue"])]),_:1}),o(s,{label:"",class:"center"},{default:a(()=>[o(k,{type:"primary",size:"large",class:"auth-btn",onClick:e[9]||(e[9]=l=>h(y.value))},{default:a(()=>e[13]||(e[13]=[c(" 确认修改 ")])),_:1})]),_:1})]),_:1},8,["model","rules"]),[[F,f.value==="change"]]),u("div",ee,[o(U,{type:"primary",class:"action-link",onClick:L},{default:a(()=>[o(C,null,{default:a(()=>[o(E(M))]),_:1}),e[14]||(e[14]=c(" 返回登录 "))]),_:1}),o(U,{type:"primary",class:"action-link",onClick:e[11]||(e[11]=l=>d.$router.push("/"))},{default:a(()=>[o(C,null,{default:a(()=>[o(E(A))]),_:1}),e[15]||(e[15]=c(" 首页 "))]),_:1})])])])}}},te=N(oe,[["__scopeId","data-v-397a7d4e"]]);export{te as default};
